apiVersion: v1
kind: ConfigMap
metadata:
  name: cross-seed-configmap
data:
  config.js: |-
    function fetchIndexers(baseUrl, apiKey, tag){
      const buffer = require('child_process').execSync(`curl -fsSL "$${baseUrl}/api/v1/tag/detail?apikey=$${apiKey}"`);
      const response = JSON.parse(buffer.toString('utf8'));
      const indexerIds = response.filter(t => t.label === tag)[0]?.indexerIds ?? [];
      const indexers = indexerIds.map(i => `$${baseUrl}/$${i}/api?apikey=$${apiKey}`);
      console.log(`Loaded $${indexers.length} indexers from Prowlarr`);
      return indexers;
    }
    module.exports = {
      action: "inject",
      apiKey: '{{ .CROSS_SEED_API_KEY }}',
      delay: 30,
      duplicateCategories: false,
      flatLinking: false,
      includeNonVideos: true,
      includeSingleEpisodes: true,
      linkCategory: "cross-seed",
      linkDirs: ["/data/downloads/torrents/cross-seed", "/data/LaunchBox/cross-seed"],
      linkType: "hardlink",
      matchMode: "partial",
      seasonFromEpisodes: 0.8,
      port: Number(process.env.CROSS_SEED_PORT),
      torrentClients: [`qbittorrent:https://{{ .QBITTORRENT_USERNAME }}:{{ .QBITTORRENT_PASSWORD }}@qbittorrent.darkfellanetwork.com`],
      radarr: [`https://radarr.darkfellanetwork.com/?apikey={{ .RADARR_API_KEY }}`],
      skipRecheck: true,
      sonarr: [`https://sonarr.darkfellanetwork.com/?apikey={{ .SONARR_API_KEY }}`],
      useClientTorrents: true,
      torznab: fetchIndexers("https://prowlarr.darkfellanetwork.com", "{{.PROWLARR_API_KEY}}", "cross-seed"),
    };
