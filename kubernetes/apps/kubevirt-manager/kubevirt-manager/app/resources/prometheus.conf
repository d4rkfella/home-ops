location /api {
    set $auth_token "";

    # Read Authorization token from file using Lua
    access_by_lua_block {
        local file = io.open("/etc/secrets/token", "r")
        if file then
            ngx.var.auth_token = "Bearer " .. file:read("*a"):gsub("%s+", "")  -- Remove extra spaces
            file:close()
        end
    }

    proxy_set_header Bearer $auth_token;  # Use the dynamically set Authorization token
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_pass_request_body on;
    proxy_pass_request_headers on;
    client_max_body_size 5g;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;
    proxy_pass https://prometheus-operated.observability.svc.cluster.local:8082;
}
