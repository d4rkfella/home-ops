apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: github-actions-vm-manager
rules:
- apiGroups: ["kubevirt.io"]
  resources: ["virtualmachines"]
  verbs: ["*"]
- apiGroups: ["subresources.kubevirt.io"]
  resources: ["virtualmachines/start", "virtualmachines/stop"]
  verbs: ["update"]
- apiGroups: ["export.kubevirt.io"]
  resources: ["virtualmachineexports"]
  verbs: ["*"]
  #verbs: ["get","create"]
- apiGroups: ["kubevirt.io"]
  resources: ["virtualmachineinstances"]
  verbs: ["*"]
- apiGroups: ["subresources.kubevirt.io"]
  resources:
    - "virtualmachineinstances/stop"
    - "virtualmachineinstances/pause"
    - "virtualmachineinstances/unpause"
    - "virtualmachineinstances/freeze"
    - "virtualmachineinstances/unfreeze"
  verbs: ["update"]
- apiGroups: ["kubevirt.io"]
  resources: ["kubevirts"]
  verbs: ["*"]
- apiGroups: [""]
  resources: ["secrets"]
  verbs: ["get","create"]
- apiGroups: [""]
  resources: ["namespaces"]
  verbs: ["get", "list"]
- apiGroups: [""]
  resources: ["persistentvolumeclaims"]
  verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: github-actions-vm-access
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubevirt.io:admin
subjects:
- kind: ServiceAccount
  name: home-ops-runner-gha-rs-kube-mode
  namespace: arc-runners
